---
layout: post
title: HTTP 메서드의 속성 (Safe, Idempotent, Cacheable)
categories: Network
tags: [HTTP, 멱등성]
---

## 1. 안전한(Safe)

: **GET**, HEAD, OPTIONS, TRACE

HTTP 메서드 중 서버에 여러 번 요청을 해도 서버의 상태가 바뀌지 않는다면(즉, 리소스를 변경하지 않는다면) 해당 메서드는 **안전** 하다고 말합니다. 대표적으로 GET 메서드와 같이 데이터를 읽기만 하는 메서드들이 이에 해당합니다.

## 2. 멱등성(Idempotent) ⭐

: **GET**, **PUT**, **DELETE**, HEAD, OPTIONS, TRACE

동일한 요청을 몇 번을 보내든 서버의 상태를 원하는 결과대로 동일한 상태를 유지할 수 있다면 **멱등**하다고 말합니다.

멱등성을 구분하는 이유는 만약 요청이 실패했을 경우 멱등하지 않은 메서드로 요청을 했다면 실패한 요청의 상태를 파악하기 어렵기 때문입니다. 이러한 상태에서 다시 요청을 보냈을 경우, 이전에 실패한 요청을 파악하지 못한 채 현재 요청이 처리되어서는 안되기 때문에 구분해야 합니다.

### 2-1. POST는 왜 멱등하지 않은가요?

POST 메서드는 리소스를 추가할 때 사용합니다. 만약 서버에 여러 번 요청하게 되면 여러 번 리소스를 추가함으로써 계속해서 변경사항을 만들기 때문에 멱등하지 않습니다.

### 2-2. PUT과 DELETE가 왜 멱등한가요?

| 메서드 | 설명                                                                                    |
| ------ | --------------------------------------------------------------------------------------- |
| PUT    | 기존 리소스가 존재한다면 전체적으로 덮어 씌워 업데이트한다. 존재하지 않는다면 생성한다. |
| DELETE | 지정한 리소스를 삭제한다. 만약 리소스가 존재하지 않는다면 404(Not Found)로 응답한다.    |

위에서 PUT과 DELETE의 정의를 보았을 때, 의도한 바와 같이 동작하였고 같은 요청을 몇 번을 하든 최종적인 서버 상태는 동일하므로 멱등하다고 말합니다.

### 2-3. 그럼 PATCH도 멱등한가요?

답을 먼저 말하자면 **PATCH 메서드는 멱등할수도, 멱등하지 않을수도 있습니다.** PATCH 메서드는 리소스를 부분적으로 수정할 때 사용합니다.
예를 들어 클라이언트가 내 정보에 있는 age를 10살로 수정하고 싶다고 가정하겠습니다. 그럼 클라이언트 쪽에서 아래와 같이 서버에 요청을 보냅니다.

```json
// case 1
{
  "age" : "10"
}

// case 2
{
  "operation" : "add",
  "age" : "1"
}
```

1번 case일 경우 최종적으로 클라이언트는 10살로 age를 수정하였고 동일한 요청을 몇 번을 하든 결과는 10살로 동일합니다. 이 경우 멱등하다고 볼 수 있습니다.

그러나 2번 case와 같이 나이를 증가시키는 요청을 보낸다면, 동일한 요청을 여러 번 하게되면 나이는 계속 +1씩 증가하게 됩니다. 그럼 처음 클라이언트가 의도한 대로 동작하지 않고 리소스가 계속 변경되기 때문에 멱등하다고 볼 수 없습니다.

## 3. 캐시가능(Cacheable)

: **GET**, HEAD

응답 결과를 캐시해서(로컬에 저장해서) 사용할 수 있는가를 말합니다. 사실 GET, HEAD, POST, PATCH 모두 캐시 가능하지만 실제로는 GET, HEAD만 주로 사용합니다.

## 4. 정리 - 표

| 메서드     | 안전 | 멱등 | 캐시가능 |
| ---------- | ---- | ---- | -------- |
| **GET**    | ✅   | ✅   | ✅       |
| **POST**   | ❌   | ❌   | ❗       |
| **PUT**    | ❌   | ✅   | ❌       |
| **PATCH**  | ❌   | ❗   | ❗       |
| **DELETE** | ❌   | ✅   | ❌       |
| HEAD       | ✅   | ✅   | ✅       |
| CONNECT    | ❌   | ❌   | ❌       |
| OPTIONS    | ✅   | ✅   | ❌       |
| TRACE      | ✅   | ✅   | ❌       |
